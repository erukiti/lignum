'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

function _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }

var stacktraceJs = _interopDefault(require('stacktrace-js'));
var ws = _interopDefault(require('ws'));
var fs = _interopDefault(require('fs'));
var path = _interopDefault(require('path'));

var commonjsGlobal = typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};





function createCommonjsModule(fn, module) {
	return module = { exports: {} }, fn(module, module.exports), module.exports;
}

var putConsole_1 = createCommonjsModule(function (module) {
const putConsole = (log, callback = msg => process.stdout.write(msg)) => {
    const message = log.args.map(obj => {
        if (obj === undefined) {
            return 'undefined'
        } else if (obj === null) {
            return 'null'
        } else if (typeof obj === 'object') {
            return JSON.stringify(obj)
        } else {
            return obj.toString()
        }
    }).join(' ');

    const at = typeof log.at === 'object' ? log.at.toLocaleTimeString() : log.at;

    let startColor = '';
    switch (log.type) {
        case 'info':
            startColor = '\x1b[36m';
            break
        case 'log':
            startColor = '\x1b[32m';
            break
        case 'debug':
            startColor = '\x1b[35m';
            break

        case 'warn':
            startColor = '\x1b[33m';
            break

        case 'error':
            startColor = '\x1b[31m';
            break
    }

    const logType = `${log.type}    `.substr(0, 5);
    // FIXME: log.name

    callback(`${startColor}${logType}\x1b[m \x1b[32m[${at}]\x1b[m ${log.source}${message}\n`);
};

module.exports = putConsole;
});

var putWs = createCommonjsModule(function (module) {
const createPutWs = (url) => {
    let logs = [];
    let putFunc = log => logs.push(log);

    const ws$$1 = new ws(ws$$1, {handshakeTimeout: 2000});
    ws$$1.on('open', () => {
        putFunc = log => commonjsGlobal.ws.send(JSON.stringify(log));
        logs.forEach(log => putFunc(log));
        logs = [];
    });
    ws$$1.on('error', err => {
        console.error(err);
        putFunc = log => console.log(logs);
        logs.forEach(log => putFunc(log));
        logs = [];
    });

    const put = log => {
        putFunc(log);
    };

    return put
};
});

class Log {
    constructor(name, root, type, args, stack) {
        this.name = name;
        this.root = root;
        this.type = type;
        this.at = new Date();
        this.args = args;
        this.stack = stack;

        this.source = '';
        let i = 0;
        while (i < stack.length) {
            const {fileName, lineNumber, columnNumber} = stack[i];
            if (fileName.indexOf(root) === 0) {
                const relative = fileName.substr(root.length + 1);
                if (relative.indexOf('node_modules/') !== 0) {
                    this.source = [relative, lineNumber, columnNumber, ' '].join(':');
                    break
                }
            }
            i++;
        }


    }
}

var log = Log;

const reWsurl = /^ws:\/\/([^:]+):([a-z]+)/;

class Logger {
    constructor(opts) {
        this.name = opts.name;
        this.root = opts.root;
        this.putFunc = [];
        this.isNode = typeof process === 'object' && typeof process.versions === 'object' && typeof process.versions.node === 'string';

        const url = process.env.LIGNUM_WS || opts.ws;
        if (url) {
            const matched = reWsurl.exec(url);
            if (matched) {
                cosnole.log(matched);
                this.putFunc.push(putWs(url));
            } else {
                console.error('WebSocket URL is wrong');
            }
        }

        if (!this.isNode) {
            this.putFunc.push(log$$1 => {
                console.log(log$$1.name, log$$1.type, log$$1.args);
            });
        } else {
            this._findRoot();
            if (process.env.LIGNUM_FILE) {
                const fs$$1 = fs;
                this.putFunc.push(log$$1 => {
                    putConsole_1(log$$1, msg => {
                        fs$$1.appendFileSync(process.env.LIGNUM_FILE, msg);
                    });
                });
            } else {
                // FIXME: もっと細かく制御
                this.putFunc.push(log$$1 => putConsole_1(log$$1));
            }
        }

        this.setLevel(opts.level || 'info');
    }

    _findRoot() {
        const traces = stacktraceJs.getSync();
        const path$$1 = path;
        const fs$$1 = fs;
        let i = 0;

        while (path$$1.dirname(traces[i].fileName) === __dirname) {
            i++;
        }
        const paths = path$$1.dirname(traces[i].fileName).split('/').filter(s => s !== '');
        // FIXME: global の時にこまりそう
        while (paths.indexOf('node_modules') !== -1) {
            paths.pop();
        }

        while (paths.length > 0) {
            try {
                const fn = path$$1.join('/', ...paths, 'package.json');
                // console.log(fn)
                const {name} = JSON.parse(fs$$1.readFileSync(fn).toString());
                this.name = name;
                this.root = path$$1.dirname(fn);
                // console.log(name, this.root)
                break
            } catch (e) {
                paths.pop();
            }
        }
    }

    setLevel(level) {
        this.level = this._getLogLevel(level);
        this.isVerboseLevel = this.level >= this._getLogLevel('verbose');
    }

    _getLogLevel(level) {
        const result = ['error', 'warn', 'info', 'verbose', 'debug'].indexOf(level);
        if (result === -1) {
            return 2
        } else {
            return result
        }
    }

    put(type, ...args) {
        if (this._getLogLevel(type) > this.level) {
            return
        }

        const log$$1 = new log(this.name, this.root, type, args, stacktraceJs.getSync());
        this.putFunc.forEach(putFunc => putFunc(log$$1));
    }

    info(...args) {
        this.put('info', ...args);
    }

    log(...args) {
        this.put('log', ...args);
    }
    verbose(...args) {
        this.put('log', ...args);
    }
    debug(...args) {
        this.put('debug', ...args);
    }

    error(...args) {
        this.put('error', ...args);
    }

    warn(...args) {
        this.put('warn', ...args);
    }
}

var logger = Logger;

var index = createCommonjsModule(function (module) {
let logger$$1 = null;

const getLogger = (opts = {}) => {
    if (!logger$$1) {
        logger$$1 = new logger(opts);
        logger$$1.verbose('logging start');
    }
    return logger$$1
};

module.exports = {getLogger};
});

var index_1 = index.getLogger;

exports['default'] = index;
exports.getLogger = index_1;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlcyI6WyIuLi9zcmMvcHV0LWNvbnNvbGUuanMiLCIuLi9zcmMvcHV0LXdzLmpzIiwiLi4vc3JjL2xvZy5qcyIsIi4uL3NyYy9sb2dnZXIuanMiLCIuLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgcHV0Q29uc29sZSA9IChsb2csIGNhbGxiYWNrID0gbXNnID0+IHByb2Nlc3Muc3Rkb3V0LndyaXRlKG1zZykpID0+IHtcbiAgICBjb25zdCBtZXNzYWdlID0gbG9nLmFyZ3MubWFwKG9iaiA9PiB7XG4gICAgICAgIGlmIChvYmogPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuICd1bmRlZmluZWQnXG4gICAgICAgIH0gZWxzZSBpZiAob2JqID09PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gJ251bGwnXG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG9iaiA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShvYmopXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gb2JqLnRvU3RyaW5nKClcbiAgICAgICAgfVxuICAgIH0pLmpvaW4oJyAnKVxuXG4gICAgY29uc3QgYXQgPSB0eXBlb2YgbG9nLmF0ID09PSAnb2JqZWN0JyA/IGxvZy5hdC50b0xvY2FsZVRpbWVTdHJpbmcoKSA6IGxvZy5hdFxuXG4gICAgbGV0IHN0YXJ0Q29sb3IgPSAnJ1xuICAgIHN3aXRjaCAobG9nLnR5cGUpIHtcbiAgICAgICAgY2FzZSAnaW5mbyc6XG4gICAgICAgICAgICBzdGFydENvbG9yID0gJ1xceDFiWzM2bSdcbiAgICAgICAgICAgIGJyZWFrXG4gICAgICAgIGNhc2UgJ2xvZyc6XG4gICAgICAgICAgICBzdGFydENvbG9yID0gJ1xceDFiWzMybSdcbiAgICAgICAgICAgIGJyZWFrXG4gICAgICAgIGNhc2UgJ2RlYnVnJzpcbiAgICAgICAgICAgIHN0YXJ0Q29sb3IgPSAnXFx4MWJbMzVtJ1xuICAgICAgICAgICAgYnJlYWtcblxuICAgICAgICBjYXNlICd3YXJuJzpcbiAgICAgICAgICAgIHN0YXJ0Q29sb3IgPSAnXFx4MWJbMzNtJ1xuICAgICAgICAgICAgYnJlYWtcblxuICAgICAgICBjYXNlICdlcnJvcic6XG4gICAgICAgICAgICBzdGFydENvbG9yID0gJ1xceDFiWzMxbSdcbiAgICAgICAgICAgIGJyZWFrXG4gICAgfVxuXG4gICAgY29uc3QgbG9nVHlwZSA9IGAke2xvZy50eXBlfSAgICBgLnN1YnN0cigwLCA1KVxuICAgIC8vIEZJWE1FOiBsb2cubmFtZVxuXG4gICAgY2FsbGJhY2soYCR7c3RhcnRDb2xvcn0ke2xvZ1R5cGV9XFx4MWJbbSBcXHgxYlszMm1bJHthdH1dXFx4MWJbbSAke2xvZy5zb3VyY2V9JHttZXNzYWdlfVxcbmApXG59XG5cbm1vZHVsZS5leHBvcnRzID0gcHV0Q29uc29sZVxuIiwiY29uc3QgV2ViU29ja2V0ID0gcmVxdWlyZSgnd3MnKVxuXG5cbmNvbnN0IGNyZWF0ZVB1dFdzID0gKHVybCkgPT4ge1xuICAgIGxldCBsb2dzID0gW11cbiAgICBsZXQgcHV0RnVuYyA9IGxvZyA9PiBsb2dzLnB1c2gobG9nKVxuXG4gICAgY29uc3Qgd3MgPSBuZXcgV2ViU29ja2V0KHdzLCB7aGFuZHNoYWtlVGltZW91dDogMjAwMH0pXG4gICAgd3Mub24oJ29wZW4nLCAoKSA9PiB7XG4gICAgICAgIHB1dEZ1bmMgPSBsb2cgPT4gdGhpcy53cy5zZW5kKEpTT04uc3RyaW5naWZ5KGxvZykpXG4gICAgICAgIGxvZ3MuZm9yRWFjaChsb2cgPT4gcHV0RnVuYyhsb2cpKVxuICAgICAgICBsb2dzID0gW11cbiAgICB9KVxuICAgIHdzLm9uKCdlcnJvcicsIGVyciA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKVxuICAgICAgICBwdXRGdW5jID0gbG9nID0+IGNvbnNvbGUubG9nKGxvZ3MpXG4gICAgICAgIGxvZ3MuZm9yRWFjaChsb2cgPT4gcHV0RnVuYyhsb2cpKVxuICAgICAgICBsb2dzID0gW11cbiAgICB9KVxuXG4gICAgY29uc3QgcHV0ID0gbG9nID0+IHtcbiAgICAgICAgcHV0RnVuYyhsb2cpXG4gICAgfVxuXG4gICAgcmV0dXJuIHB1dFxufVxuIiwiY2xhc3MgTG9nIHtcbiAgICBjb25zdHJ1Y3RvcihuYW1lLCByb290LCB0eXBlLCBhcmdzLCBzdGFjaykge1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lXG4gICAgICAgIHRoaXMucm9vdCA9IHJvb3RcbiAgICAgICAgdGhpcy50eXBlID0gdHlwZVxuICAgICAgICB0aGlzLmF0ID0gbmV3IERhdGUoKVxuICAgICAgICB0aGlzLmFyZ3MgPSBhcmdzXG4gICAgICAgIHRoaXMuc3RhY2sgPSBzdGFja1xuXG4gICAgICAgIHRoaXMuc291cmNlID0gJydcbiAgICAgICAgbGV0IGkgPSAwXG4gICAgICAgIHdoaWxlIChpIDwgc3RhY2subGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCB7ZmlsZU5hbWUsIGxpbmVOdW1iZXIsIGNvbHVtbk51bWJlcn0gPSBzdGFja1tpXVxuICAgICAgICAgICAgaWYgKGZpbGVOYW1lLmluZGV4T2Yocm9vdCkgPT09IDApIHtcbiAgICAgICAgICAgICAgICBjb25zdCByZWxhdGl2ZSA9IGZpbGVOYW1lLnN1YnN0cihyb290Lmxlbmd0aCArIDEpXG4gICAgICAgICAgICAgICAgaWYgKHJlbGF0aXZlLmluZGV4T2YoJ25vZGVfbW9kdWxlcy8nKSAhPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNvdXJjZSA9IFtyZWxhdGl2ZSwgbGluZU51bWJlciwgY29sdW1uTnVtYmVyLCAnICddLmpvaW4oJzonKVxuICAgICAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGkrK1xuICAgICAgICB9XG5cblxuICAgIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBMb2dcbiIsImNvbnN0IHN0ID0gcmVxdWlyZSgnc3RhY2t0cmFjZS1qcycpXG5cbmNvbnN0IHB1dENvbnNvbGUgPSByZXF1aXJlKCcuL3B1dC1jb25zb2xlJylcbmNvbnN0IGNyZWF0ZVB1dFdzID0gcmVxdWlyZSgnLi9wdXQtd3MnKVxuY29uc3QgTG9nID0gcmVxdWlyZSgnLi9sb2cnKVxuXG5jb25zdCByZVdzdXJsID0gL153czpcXC9cXC8oW146XSspOihbYS16XSspL1xuXG5jbGFzcyBMb2dnZXIge1xuICAgIGNvbnN0cnVjdG9yKG9wdHMpIHtcbiAgICAgICAgdGhpcy5uYW1lID0gb3B0cy5uYW1lXG4gICAgICAgIHRoaXMucm9vdCA9IG9wdHMucm9vdFxuICAgICAgICB0aGlzLnB1dEZ1bmMgPSBbXVxuICAgICAgICB0aGlzLmlzTm9kZSA9IHR5cGVvZiBwcm9jZXNzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgcHJvY2Vzcy52ZXJzaW9ucyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIHByb2Nlc3MudmVyc2lvbnMubm9kZSA9PT0gJ3N0cmluZydcblxuICAgICAgICBjb25zdCB1cmwgPSBwcm9jZXNzLmVudi5MSUdOVU1fV1MgfHwgb3B0cy53c1xuICAgICAgICBpZiAodXJsKSB7XG4gICAgICAgICAgICBjb25zdCBtYXRjaGVkID0gcmVXc3VybC5leGVjKHVybClcbiAgICAgICAgICAgIGlmIChtYXRjaGVkKSB7XG4gICAgICAgICAgICAgICAgY29zbm9sZS5sb2cobWF0Y2hlZClcbiAgICAgICAgICAgICAgICB0aGlzLnB1dEZ1bmMucHVzaChjcmVhdGVQdXRXcyh1cmwpKVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdXZWJTb2NrZXQgVVJMIGlzIHdyb25nJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGhpcy5pc05vZGUpIHtcbiAgICAgICAgICAgIHRoaXMucHV0RnVuYy5wdXNoKGxvZyA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cobG9nLm5hbWUsIGxvZy50eXBlLCBsb2cuYXJncylcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9maW5kUm9vdCgpXG4gICAgICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTElHTlVNX0ZJTEUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJylcbiAgICAgICAgICAgICAgICB0aGlzLnB1dEZ1bmMucHVzaChsb2cgPT4ge1xuICAgICAgICAgICAgICAgICAgICBwdXRDb25zb2xlKGxvZywgbXNnID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZzLmFwcGVuZEZpbGVTeW5jKHByb2Nlc3MuZW52LkxJR05VTV9GSUxFLCBtc2cpXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gRklYTUU6IOOCguOBo+OBqOe0sOOBi+OBj+WItuW+oVxuICAgICAgICAgICAgICAgIHRoaXMucHV0RnVuYy5wdXNoKGxvZyA9PiBwdXRDb25zb2xlKGxvZykpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNldExldmVsKG9wdHMubGV2ZWwgfHwgJ2luZm8nKVxuICAgIH1cblxuICAgIF9maW5kUm9vdCgpIHtcbiAgICAgICAgY29uc3QgdHJhY2VzID0gc3QuZ2V0U3luYygpXG4gICAgICAgIGNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJylcbiAgICAgICAgY29uc3QgZnMgPSByZXF1aXJlKCdmcycpXG4gICAgICAgIGxldCBpID0gMFxuXG4gICAgICAgIHdoaWxlIChwYXRoLmRpcm5hbWUodHJhY2VzW2ldLmZpbGVOYW1lKSA9PT0gX19kaXJuYW1lKSB7XG4gICAgICAgICAgICBpKytcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwYXRocyA9IHBhdGguZGlybmFtZSh0cmFjZXNbaV0uZmlsZU5hbWUpLnNwbGl0KCcvJykuZmlsdGVyKHMgPT4gcyAhPT0gJycpXG4gICAgICAgIC8vIEZJWE1FOiBnbG9iYWwg44Gu5pmC44Gr44GT44G+44KK44Gd44GGXG4gICAgICAgIHdoaWxlIChwYXRocy5pbmRleE9mKCdub2RlX21vZHVsZXMnKSAhPT0gLTEpIHtcbiAgICAgICAgICAgIHBhdGhzLnBvcCgpXG4gICAgICAgIH1cblxuICAgICAgICB3aGlsZSAocGF0aHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCBmbiA9IHBhdGguam9pbignLycsIC4uLnBhdGhzLCAncGFja2FnZS5qc29uJylcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhmbilcbiAgICAgICAgICAgICAgICBjb25zdCB7bmFtZX0gPSBKU09OLnBhcnNlKGZzLnJlYWRGaWxlU3luYyhmbikudG9TdHJpbmcoKSlcbiAgICAgICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lXG4gICAgICAgICAgICAgICAgdGhpcy5yb290ID0gcGF0aC5kaXJuYW1lKGZuKVxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKG5hbWUsIHRoaXMucm9vdClcbiAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIHBhdGhzLnBvcCgpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzZXRMZXZlbChsZXZlbCkge1xuICAgICAgICB0aGlzLmxldmVsID0gdGhpcy5fZ2V0TG9nTGV2ZWwobGV2ZWwpXG4gICAgICAgIHRoaXMuaXNWZXJib3NlTGV2ZWwgPSB0aGlzLmxldmVsID49IHRoaXMuX2dldExvZ0xldmVsKCd2ZXJib3NlJylcbiAgICB9XG5cbiAgICBfZ2V0TG9nTGV2ZWwobGV2ZWwpIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gWydlcnJvcicsICd3YXJuJywgJ2luZm8nLCAndmVyYm9zZScsICdkZWJ1ZyddLmluZGV4T2YobGV2ZWwpXG4gICAgICAgIGlmIChyZXN1bHQgPT09IC0xKSB7XG4gICAgICAgICAgICByZXR1cm4gMlxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHV0KHR5cGUsIC4uLmFyZ3MpIHtcbiAgICAgICAgaWYgKHRoaXMuX2dldExvZ0xldmVsKHR5cGUpID4gdGhpcy5sZXZlbCkge1xuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBsb2cgPSBuZXcgTG9nKHRoaXMubmFtZSwgdGhpcy5yb290LCB0eXBlLCBhcmdzLCBzdC5nZXRTeW5jKCkpXG4gICAgICAgIHRoaXMucHV0RnVuYy5mb3JFYWNoKHB1dEZ1bmMgPT4gcHV0RnVuYyhsb2cpKVxuICAgIH1cblxuICAgIGluZm8oLi4uYXJncykge1xuICAgICAgICB0aGlzLnB1dCgnaW5mbycsIC4uLmFyZ3MpXG4gICAgfVxuXG4gICAgbG9nKC4uLmFyZ3MpIHtcbiAgICAgICAgdGhpcy5wdXQoJ2xvZycsIC4uLmFyZ3MpXG4gICAgfVxuICAgIHZlcmJvc2UoLi4uYXJncykge1xuICAgICAgICB0aGlzLnB1dCgnbG9nJywgLi4uYXJncylcbiAgICB9XG4gICAgZGVidWcoLi4uYXJncykge1xuICAgICAgICB0aGlzLnB1dCgnZGVidWcnLCAuLi5hcmdzKVxuICAgIH1cblxuICAgIGVycm9yKC4uLmFyZ3MpIHtcbiAgICAgICAgdGhpcy5wdXQoJ2Vycm9yJywgLi4uYXJncylcbiAgICB9XG5cbiAgICB3YXJuKC4uLmFyZ3MpIHtcbiAgICAgICAgdGhpcy5wdXQoJ3dhcm4nLCAuLi5hcmdzKVxuICAgIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBMb2dnZXJcbiIsImNvbnN0IExvZ2dlciA9IHJlcXVpcmUoJy4vbG9nZ2VyJylcblxubGV0IGxvZ2dlciA9IG51bGxcblxuY29uc3QgZ2V0TG9nZ2VyID0gKG9wdHMgPSB7fSkgPT4ge1xuICAgIGlmICghbG9nZ2VyKSB7XG4gICAgICAgIGxvZ2dlciA9IG5ldyBMb2dnZXIob3B0cylcbiAgICAgICAgbG9nZ2VyLnZlcmJvc2UoJ2xvZ2dpbmcgc3RhcnQnKVxuICAgIH1cbiAgICByZXR1cm4gbG9nZ2VyXG59XG5cbm1vZHVsZS5leHBvcnRzID0ge2dldExvZ2dlcn1cbiJdLCJuYW1lcyI6WyJ3cyIsIldlYlNvY2tldCIsInRoaXMiLCJjcmVhdGVQdXRXcyIsImxvZyIsImZzIiwicmVxdWlyZSQkMCIsInB1dENvbnNvbGUiLCJzdCIsInBhdGgiLCJyZXF1aXJlJCQxIiwiTG9nIiwibG9nZ2VyIiwiTG9nZ2VyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsTUFBTSxVQUFVLEdBQUcsQ0FBQyxHQUFHLEVBQUUsUUFBUSxHQUFHLEdBQUcsSUFBSSxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsS0FBSztJQUNyRSxNQUFNLE9BQU8sR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUk7UUFDaEMsSUFBSSxHQUFHLEtBQUssU0FBUyxFQUFFO1lBQ25CLE9BQU8sV0FBVztTQUNyQixNQUFNLElBQUksR0FBRyxLQUFLLElBQUksRUFBRTtZQUNyQixPQUFPLE1BQU07U0FDaEIsTUFBTSxJQUFJLE9BQU8sR0FBRyxLQUFLLFFBQVEsRUFBRTtZQUNoQyxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDO1NBQzdCLE1BQU07WUFDSCxPQUFPLEdBQUcsQ0FBQyxRQUFRLEVBQUU7U0FDeEI7S0FDSixDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBQzs7SUFFWixNQUFNLEVBQUUsR0FBRyxPQUFPLEdBQUcsQ0FBQyxFQUFFLEtBQUssUUFBUSxHQUFHLEdBQUcsQ0FBQyxFQUFFLENBQUMsa0JBQWtCLEVBQUUsR0FBRyxHQUFHLENBQUMsR0FBRTs7SUFFNUUs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
